<!DOCTYPE html>
<html><head>
<title></title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'G-GGX6B7CJG5', 'auto');
	
	ga('send', 'pageview');
}
</script>







  




<link rel="icon" href="https://github.com/koolaidxk1d.png">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.a6b0bcb25b2aaef899d0a3c8ae731ea776edd7912254d9a502cf30f2983c19d3.css" integrity="sha256-prC8slsqrviZ0KPIrnMep3bt15EiVNmlAs8w8pg8GdM=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts/about">
                    About
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#level-0---backup" class="nav-level-0---backup">
									Level 0 - ~/.backup
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-1---check" class="nav-level-1---check">
									Level 1 - ~/check
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-2---printfile" class="nav-level-2---printfile">
									Level 2 - ~/printfile
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-3---level3" class="nav-level-3---level3">
									Level 3 - ~/level3
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://koolaidxk1d.github.io/">
            koolaidxk1d
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://koolaidxk1d.github.io/">
        <div class="single-column-header-title">koolaidxk1d</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    
                    
                    <div class="post-meta">
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>OverTheWire&rsquo;s Leviathan wargame is all about reverse engineering of x86 binaries. The description of the game states that it only requires knowledge of linux command line utilities, and little to no programming experience.</p>
<p>Each level goes as such:</p>
<ol>
<li>You ssh into the server as the user whose password you obtained from the previous level.</li>
<li>Through whatever means necessary, you get the password to the next level.</li>
</ol>
<p>There are no hints given for any of the levels, so it is completely up to us to figure out what we are looking for.</p>
<p>Let&rsquo;s get started.</p>
<hr>
<h2 id="level-0---backup">Level 0 - ~/.backup</h2>
<p>Logging in using the username as the password, we are met with a welcome screen. The first thing I always do is list all files in the home folder.</p>
<p>We can see something unusual; a hidden folder is present called &lsquo;.backup&rsquo;. Within that, a bookmarks file.</p>
<p>Just for kicks, lets try to grep out anything related to a password&hellip;</p>
<!-- raw HTML omitted -->
<p><img src="/images/leviathan0-0.png" alt=""></p>
<!-- raw HTML omitted -->
<p><em>Well!</em> That was easy! On to the next one.</p>
<hr>
<h2 id="level-1---check">Level 1 - ~/check</h2>
<p>In this level we have only one thing in our home directory: a setuid binary called check.</p>
<p>SetUID binaries are special executables that, when executed, run with the permissions of the user that owns the file. In this case, the file is owned by leviathan2.</p>
<p>I know from previous wargames that passwords are usually stored in /etc/somewargame_pass/. If we can somehow get this executable to read out the password file for leviathan2, we can get to the next level.</p>
<p>First, let&rsquo;s run the program.</p>
<p><img src="/images/leviathan1-0.png" alt=""></p>
<p><em>Hmm&hellip;</em></p>
<p>In order to learn more about what this file is doing, let&rsquo;s open it in <a href="https://github.com/NationalSecurityAgency/ghidra">Ghidra</a>.</p>
<p><img src="/images/leviathan1-1.png" alt=""></p>
<p>Looking at the main function above, we can see that the program does the following:</p>
<ol>
<li>Take input from the user.</li>
<li>Strcmp the output against an array of characters stored in &ldquo;local_28&rdquo; (a seemingly arbitrary variable name given by ghidra during analysis)</li>
<li>If the inputs match, then execute a shell under leviathan2&rsquo;s UID</li>
</ol>
<p>Perfect. We need that shell to get the password to the next level. Looking at local_28, we see &ldquo;\0xes&rdquo; is stored there. Since we are in little-endian, we need to swap these bytes around, giving us &ldquo;sex\0&rdquo;. Ignoring the null character at the end, the password must then be &ldquo;sex&rdquo;&hellip;</p>
<p><img src="/images/leviathan1-2.png" alt=""></p>
<p>And there we have it.</p>
<hr>
<h2 id="level-2---printfile">Level 2 - ~/printfile</h2>
<p>Again we begin with a setuid binary owned by the next level&rsquo;s user.</p>
<p><img src="/images/leviathan2-0.png" alt=""></p>
<p>The program prints a file specified by the user at runtime. But strangely, this setuid binary, although owned by leviathan3, can&rsquo;t access leviathan3&rsquo;s password file.</p>
<p>Ahem, Ghidra!</p>
<p><img src="/images/leviathan2-1.png" alt=""></p>
<p>Ok, we can see that the program checks if a file is accessible to the current UID (leviathan2) before conditionally checking whether to set the uid to leviathan3.</p>
<p>This explains why we were not able to print the file.</p>
<p>There is something else here that is interesting, however. On line 25, we can see that a buffer, arbitrarily named &ldquo;auStack_214&rdquo;, is filled with the command which will run on line 29 after the setuid call. The formatted string uses the first parameter given by the user at runtime. There is no input validation being done by the program, which is a potential hole we can use to force the program to execute our own commands. This is sometimes called <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">&ldquo;command injection&rdquo;</a>.</p>
<p><em>But there is a catch.</em></p>
<p>The only way the system call will be made is if the parameter also matches a legitimate accessible file, given the conditional statement(s) at lines 23-24.</p>
<p>How about we name a file after the command we need to run following &ldquo;/bin/cat&rdquo;? We can use the special character &lsquo;&amp;&rsquo; to run another command directly after cat.</p>
<p>Let&rsquo;s touch the file <strong>'&amp;sh'</strong> and try to use it as an input to printfile. This should give us a shell running under leviathan3.</p>
<p><img src="/images/leviathan2-2.png" alt=""></p>
<p>There&rsquo;s our password!</p>
<p><em>Note: There are probably many other commands you could craft to achieve the same result. This is simply the first one I managed to think up.</em></p>
<h2 id="level-3---level3">Level 3 - ~/level3</h2>
<p>coming soon&hellip;</p>

                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/leviathan/">
			Next<br>OverTheWire: Leviathan
                </a>
                
                
                
                <a class="older-posts">
			Previous<br>No older posts.
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










<script src="https://utteranc.es/client.js"
        repo="koolaidxk1d/koolaidxk1d.github.io"
        issue-term="title"
        label="your label"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://koolaidxk1d.github.io/">
    
        <div class="nav-title">
            koolaidxk1d
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts/about">
                About
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        

&copy;
	
	2023 koolaidxk1d
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#level-0---backup" class="nav-level-0---backup">
									Level 0 - ~/.backup
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-1---check" class="nav-level-1---check">
									Level 1 - ~/check
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-2---printfile" class="nav-level-2---printfile">
									Level 2 - ~/printfile
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-3---level3" class="nav-level-3---level3">
									Level 3 - ~/level3
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">

&copy;
	
	2023 koolaidxk1d
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
